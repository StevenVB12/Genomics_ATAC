#!/bin/bash
#SBATCH --mem-per-cpu=12gb
#SBATCH --time=24:00:00
#SBATCH --job-name=hisat
#SBATCH --error=hisat
#SBATCH --output=hisat
#SBATCH --partition=rpapaplus
#SBATCH --ntasks=8

indID=$((SLURM_ARRAY_TASK_ID -1))

module load python3/3.6.10 

module load hisat2/2.0.5
module load samtools
module load jdk

#39
#SRR=(SRR9620105 SRR9620153 SRR9620109 SRR9620152 SRR9620174 SRR9620136 SRR9620122 SRR9620139 SRR9620155 SRR9620108 SRR9620097 SRR9620137 SRR9620126 SRR9620107 SRR9620154 SRR9620173 SRR9620132 SRR9620156 SRR9620123 SRR9620096 SRR9620121 SRR9620187 SRR9620209 SRR9620189 SRR9620161 SRR9620133 SRR9620110 SRR9620186 SRR9620188 SRR9620124 SRR9620099 SRR9620125 SRR9620098 SRR9620100 SRR9620135 SRR9620175 SRR9620134 SRR9620138 SRR9620106)           
#FILE=(FCH53NVBBXX_L5_HKBUTpreTACKRAAPEI-215 FCH53NVBBXX_L5_HKBUTpreTACGRAAPEI-211 FCH53NVBBXX_L5_HKBUTpreTACIRAAPEI-213 FCH53NVBBXX_L5_HKBUTpreTACNRAAPEI-219 FCH53NVBBXX_L5_HKBUTpreTACRRAAPEI-223 FCH53NVBBXX_L5_HKBUTpreTACCRAAPEI-207 FCH5WGGBBXX-HKBUTvduTBABRAAPEI-204_L8 FCH53NVBBXX_L5_HKBUTpreTACARAAPEI-205 FCH53NVBBXX_L5_HKBUTpreTACMRAAPEI-218 FCH53NVBBXX_L5_HKBUTpreTACJRAAPEI-214 FCH53NVBBXX_L5_HKBUTpreTACLRAAPEI-216 FCH53NVBBXX_L5_HKBUTpreTACDRAAPEI-208 FCH5WGGBBXX-HKBUTpreTACURAAPEI-201_L8 FCH5WGGBBXX-HKBUTpreTACVRAAPEI-202_L8 FCH5WGGBBXX-HKBUTpreTACQRAAPEI-222_L8 FCH53NVBBXX_L5_HKBUTpreTACORAAPEI-220 FCH53NVBBXX_L5_HKBUTpreTACPRAAPEI-221 FCH53NVBBXX_L5_HKBUTpreTACHRAAPEI-212 FCH53NVBBXX_L5_HKBUTpreTACTRAAPEI-227 FCHCGHKBBXX-HKBUTgfkTAAMRAAPEI-216_L1 FCHCGHKBBXX-HKBUTgfkTAASRAAPEI-223_L1 FCHCGHKBBXX-HKBUTgfkTAATRAAPEI-225_L1 FCHCGHKBBXX-HKBUTgfkTAAURAAPEI-227_L1 FCHCGHKBBXX-HKBUTgfkTAAVRAAPEI-201_L1 FCHCGHLBBXX-HKBUTgfkTAANRCAPEI-218_L8 FCHCGHLBBXX-HKBUTgfkTAAORABPEI-219_L8 FCHCGHLBBXX-HKBUTgfkTAAPRABPEI-220_L8 FCHCGHKBBXX-HKBUTgfkTAAQRAAPEI-221_L1 FCHCGHKBBXX-HKBUTgfkTABCRAAPEI-210_L1 FCHCGHKBBXX-HKBUTgfkTABERAAPEI-212_L1 FCHCGHKBBXX-HKBUTgfkTABFRAAPEI-213_L1 FCH5WGGBBXX-HKBUTvduTBALRAAPEI-214_L8 FCH5WGGBBXX-HKBUTvduTBAMRAAPEI-216_L8 FCHCGHKBBXX-HKBUTgfkTABDRAAPEI-211_L1 FCH53NVBBXX_L5_HKBUTpreTACSRAAPEI-225 FCH53NVBBXX_L5_HKBUTpreTACFRAAPEI-210 FCH53NVBBXX_L5_HKBUTpreTACBRAAPEI-206 FCH53NVBBXX_L5_HKBUTpreTACERAAPEI-209 FCH5WGGBBXX-HKBUTvduTBAARAAPEI-203_L8)           
#name=(A4_HPo2f B2_FD2f B4_HA2f B8_FP1f C3_FD1f C4_FM2f C6_HA1f C9_FP2f D10_FP1f D6_HA2f D9_HPo2f E3_FM2f E6_FP2f F21_HPo1f F8_FM1f G21_FM1f G5_FM1f G6_FD2f H4_HA1f Heh017PAf Heh033DPf Heh033EDf Heh034IPf Heh034JDf Heh17DBf Heh25CPf Heh25DDf Heh36PCf Heh46HWHf Hep40FWCf Hep40HWDf Hep41FWC_Crawlerf Hep41HWD_Crawlerf Hep47HWHf I8_FD1f J4_FD1f J8_FP2f N3_FM2f S3_HPo1f)  
#name=(C9_FP2f B8_FP1f D10_FP1f)

#hisat2 -p 4 -x /work/rpapa/share/REF/H_erato_dem/Herato_final_hisat2 \
#-1 /work/rpapa/share/RNAseq_Joe/$(echo "${SRR[indID]}")/$(echo "${FILE[indID]}")_1.fq.gz \
#-2 /work/rpapa/share/RNAseq_Joe/$(echo "${SRR[indID]}")/$(echo "${FILE[indID]}")_2.fq.gz | samtools view -bSh - > BAM/$(echo "${name[indID]}")_erato.bam

#samtools view -f 0x02 -q 20 -b BAM/$(echo "${name[indID]}")_erato.bam > BAM/$(echo "${name[indID]}")_erato.filtered.bam

#samtools sort BAM/$(echo "${name[indID]}")_erato.filtered.bam BAM/$(echo "${name[indID]}")_erato.filtered.sorted

#java -jar /work/rpapa/sbelleghem/Programs/picard-tools-2.5.0/picard.jar MarkDuplicates \
#I=BAM/$(echo "${name[indID]}")_erato.filtered.sorted.bam \
#O=BAM/$(echo "${name[indID]}")_erato.filtered.sorted.nd.bam \
#Remove_Duplicates=true  M=BAM/$(echo "${name[indID]}")_erato.filtered.sorted_dup_metrics.txt ASSUME_SORTED=true

#rm BAM/$(echo "${name[indID]}")_erato.filtered.bam
#rm BAM/$(echo "${name[indID]}")_erato.filtered.sorted.bam

#htseq-count -c htseq/$(echo "${name[indID]}")_erato_nonStranded.counts -n 8 -s no --idattr Parent BAM/$(echo "${name[indID]}")_erato.filtered.sorted.nd.bam ~/share/REF/GFF/Heliconius_erato_demophoon_v1.gff3



                                                 
#50                                                 
#SRR=(SRR9620127 SRR9620142 SRR9620143 SRR9620144 SRR9620145 SRR9620140 SRR9620160 SRR9620159 SRR9620158 SRR9620157 SRR9620162 SRR9620169 SRR9620168 SRR9620170 SRR9620172 SRR9620191 SRR9620192 SRR9620193 SRR9620194 SRR9620195 SRR9620184 SRR9620182 SRR9620183 SRR9620185 SRR9620181 SRR9620206 SRR9620205 SRR9620208 SRR9620207 SRR9620103 SRR9620101 SRR9620104 SRR9620171 SRR9620092 SRR9620091 SRR9620201 SRR9620203 SRR9620141 SRR9620204 SRR9620151 SRR9620118 SRR9620117 SRR9620120 SRR9620119 SRR9620102 SRR9620116 SRR9620202 SRR9620095 SRR9620094 SRR9620093)
#FILE=(FCH53NVBBXX_L1_HKBUTpreTAAARAAPEI-201 FCH53NVBBXX_L1_HKBUTpreTAABRAAPEI-202 FCH53NVBBXX_L1_HKBUTpreTAACRAAPEI-203 FCH53NVBBXX_L1_HKBUTpreTAADRAAPEI-204 FCH53NVBBXX_L1_HKBUTpreTAAERAAPEI-205 FCH53NVBBXX_L1_HKBUTpreTAAFRAAPEI-206 FCH53NVBBXX_L1_HKBUTpreTAAGRAAPEI-207 FCH53NVBBXX_L1_HKBUTpreTAAHRAAPEI-208 FCH53NVBBXX_L1_HKBUTpreTAAIRAAPEI-209 FCH53NVBBXX_L1_HKBUTpreTAAJRAAPEI-210 FCH53NVBBXX_L1_HKBUTpreTAAKRAAPEI-211 FCH53NVBBXX_L1_HKBUTpreTAALRAAPEI-212 FCH53NVBBXX_L1_HKBUTpreTAAMRAAPEI-213 FCH53NVBBXX_L1_HKBUTpreTAANRAAPEI-214 FCH53NVBBXX_L1_HKBUTpreTAAORAAPEI-215 FCH53NVBBXX_L1_HKBUTpreTAAPRAAPEI-216 FCH53NVBBXX_L1_HKBUTpreTAAQRAAPEI-218 FCH53NVBBXX_L1_HKBUTpreTAARRAAPEI-219 FCH53NVBBXX_L1_HKBUTpreTAASRAAPEI-220 FCH5WGGBBXX-HKBUTvduTBADRAAPEI-206_L8 FCH5WGGBBXX-HKBUTvduTBAERAAPEI-207_L8 FCH5WGGBBXX-HKBUTvduTBAFRAAPEI-208_L8 FCH5WGGBBXX-HKBUTvduTBAGRAAPEI-209_L8 FCH5WGGBBXX-HKBUTvduTBANRAAPEI-218_L8 FCH53NVBBXX_L1_HKBUTpreTAATRAAPEI-221 FCH53NVBBXX_L1_HKBUTpreTAAURAAPEI-222 FCH53NVBBXX_L1_HKBUTpreTAAVRAAPEI-223 FCH5WGGBBXX-HKBUTpreTAAWRAAPEI-225_L8 FCH5WGGBBXX-HKBUTpreTAAXRAAPEI-227_L8 FCH5WGGBBXX-HKBUTvduTBAIRAAPEI-211_L8 FCH5WGGBBXX-HKBUTvduTBACRAAPEI-205_L8 FCH5WGGBBXX-HKBUTvduTBAHRAAPEI-210_L8 FCH5WGGBBXX-HKBUTvduTBAJRAAPEI-212_L8 FCHCGHLBBXX-HKBUTgfkTAACRAAPEI-205_L8 FCHCGHLBBXX-HKBUTgfkTAABRAAPEI-202_L8 FCHCGHLBBXX-HKBUTgfkTAADRAAPEI-206_L8 FCH5WGGBBXX-HKBUTvduTBAKRAAPEI-213_L8 FCHCGHLBBXX-HKBUTgfkTAAFRABPEI-208_L8 FCHCGHKBBXX-HKBUTgfkTABBRAAPEI-209_L1 FCHCGHKBBXX-HKBUTgfkTABARAAPEI-208_L1 FCHCGHLBBXX-HKBUTgfkTAAHRAAPEI-210_L8 FCHCGHLBBXX-HKBUTgfkTAAGRABPEI-209_L8 FCHCGHLBBXX-HKBUTgfkTAAJRAAPEI-212_L8 FCHCGHLBBXX-HKBUTgfkTAAIRAAPEI-211_L8 FCHCGHLBBXX-HKBUTgfkTAALRABPEI-214_L8 FCHCGHLBBXX-HKBUTgfkTAAKRAAPEI-213_L8 FCHCGHKBBXX-HKBUTgfkTAAZRAAPEI-207_L1 FCHCGHKBBXX-HKBUTgfkTAAWRAAPEI-202_L1 FCHCGHKBBXX-HKBUTgfkTAAXRAAPEI-205_L1 FCHCGHKBBXX-HKBUTgfkTAAYRAAPEI-206_L1)
name=(13Ff_ 13Gf_ 13Hf_ 13If_ 13Jf_ 14Af_ 14Bf_ 14Cf_ 14Df_ 14Ef_ 14Ff_ 14Gf_ 14Hf_ 14Jf_ 15Af_ 15Bf_ 15Cf_ 15Df_ 15Ef_ 16Af_ 16Bf_ 16Df_ 16Ef_ 16Hf_ 17Ff_ 17Gf_ 17Hf_ 17If_ 17Jf_ 2213Ff_ 2213Gf_ 2213Jf_ 24Df_ Hmm49DAf_ Hmm49PBf_ Hmm52EPf_ Hmm54GPf_ Hmm54HDf_ Hmm55HWJf_ Hmm56HWBf_ Hmm59DDf_ Hmm59PCf_ Hmm61DFf_ Hmm61PEf_ Hmm62DHf_ Hmm62PGf_ Hmr37HWBf_ Hmr44HWHf_ Hmr45FWEf_ Hmr45HWFf_)
name=(13Gf_)

#hisat2 -p 4 -x /work/rpapa/share/REF/Hmel2/Hmel2_hisat2 \
#-1 /work/rpapa/share/RNAseq_Joe/$(echo "${SRR[indID]}")/$(echo "${FILE[indID]}")_1.fq.gz \
#-2 /work/rpapa/share/RNAseq_Joe/$(echo "${SRR[indID]}")/$(echo "${FILE[indID]}")_2.fq.gz | samtools view -bSh - > BAM/$(echo "${name[indID]}")_melp.bam

#samtools view -f 0x02 -q 20 -b BAM/$(echo "${name[indID]}")melp.bam > BAM/$(echo "${name[indID]}")melp.filtered.bam

#samtools sort BAM/$(echo "${name[indID]}")melp.filtered.bam BAM/$(echo "${name[indID]}")melp.filtered.sorted

#java -jar /work/rpapa/sbelleghem/Programs/picard-tools-2.5.0/picard.jar MarkDuplicates \
#I=BAM/$(echo "${name[indID]}")melp.filtered.sorted.bam \
#O=BAM/$(echo "${name[indID]}")melp.filtered.sorted.nd.bam \
#Remove_Duplicates=true  M=BAM/$(echo "${name[indID]}")melp.filtered.sorted_dup_metrics.txt ASSUME_SORTED=true

#rm BAM/$(echo "${name[indID]}")melp.filtered.bam 
#rm BAM/$(echo "${name[indID]}")melp.filtered.sorted.bam

htseq-count -c htseq/$(echo "${name[indID]}")melp_nonStranded.counts -n 8 --idattr Parent BAM/$(echo "${name[indID]}")melp.filtered.sorted.nd.bam ~/share/REF/GFF/Heliconius_melpomene_melpomene_Hmel2.gff3

